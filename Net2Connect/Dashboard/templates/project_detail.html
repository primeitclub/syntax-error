{% extends "dashboard.html" %}

{% block title %}Project Details - {{ project.title }}{% endblock %}

{% block content %}
<div class="container my-4">

  <h1 class="mb-3">{{ project.title }}</h1>

  <div class="mb-4">
    <strong>Status:</strong> <span class="badge bg-info">{{ project.get_status_display }}</span><br>
    <strong>Access Type:</strong> {{ project.get_access_type_display }}<br>
    <strong>Owner:</strong> {{ project.owner.username }}<br>
    <strong>Members:</strong> {{ project.members.count }} / {{ project.max_members }}<br>
  </div>

  <section class="mb-4">
    <h3>Description</h3>
    <p>{{ project.description|linebreaks }}</p>
  </section>

  <section class="mb-4">
    <h3>Required Skills</h3>
    {% if project.required_skills.exists %}
      <ul class="list-inline">
        {% for skill in project.required_skills.all %}
          <li class="list-inline-item badge bg-secondary">{{ skill.name }}</li>
        {% endfor %}
      </ul>
    {% else %}
      <p><em>No specific skills required.</em></p>
    {% endif %}
  </section>

  <section class="mb-4">
    <h3>Required Fields</h3>
    {% if project.required_fields %}
      <p>{{ project.required_fields }}</p>
    {% else %}
      <p><em>No specific fields required.</em></p>
    {% endif %}
  </section>

  <section class="mb-4">
    <h3>Members ({{ project.members.count }})</h3>
    {% if project.members.exists %}
      <ul>
        {% for member in project.members.all %}
          <li>
            <a href="{% url 'account:profile' %}">
              {{ member.username }}
            </a>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p><em>No members yet.</em></p>
    {% endif %}
  </section>

  <section class="mb-4">
  <!-- Action buttons example (customize URLs) -->
  {% if user == project.owner %}
    <a href="{% url 'dashboard:update_project' project.id %}" class="btn btn-primary me-2">Edit Project</a>
    <a href="{% url 'dashboard:delete_project' project.id %}" class="btn btn-danger">Delete Project</a>
  {% else %}
    {% if user in project.members.all %}
      <form method="post" action="{% url 'dashboard:leave_project' project.id %}" class="d-inline">
        {% csrf_token %}
        <button type="submit" class="btn btn-warning">Leave Project</button>
      </form>
    {% elif project.access_type == 'open' and project.members.count < project.max_members %}
      <form method="post" action="{% url 'dashboard:join_project' project.id %}" class="d-inline">
        {% csrf_token %}
        <button type="submit" class="btn btn-success">Join Project</button>
      </form>
    {% elif project.access_type == 'invite' and user in project.invited_users.all and project.members.count < project.max_members %}
      <form method="post" action="{% url 'dashboard:join_project' project.id %}" class="d-inline">
        {% csrf_token %}
        <button type="submit" class="btn btn-success">Accept Invitation</button>
      </form>
    {% else %}
      <button class="btn btn-secondary" disabled>Joining Not Allowed</button>
    {% endif %}
  {% endif %}
</section>


</div>
{% endblock %}
